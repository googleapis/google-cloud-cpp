# How-to Guide: Update googleapis SHA

As of 11-07-2023, we are using a GHA to update the googleapis SHA. This runs
once a week on Sundays and is generated by
[updated-googleapis-sha](updated-googleapis-sha).

To manually invoke the workflow, create a branch on the upstream repo with the
prefix `ci-gha-googleapis`, and push an empty commit to it.

```shell
git checkout -b ci-gha-googleapis-circa-$(date +%Y-%m-%d)
git commit --allow-empty
git push
```

This document remains for anyone who wishes to perform the manual steps. This
document describes the manual steps required to update the commit SHA for the
[googleapis][googleapis-repo] repository. The document is intended for
contributors to the `google-cloud-cpp` libraries. It assumes you are familiar
with the build systems used in these libraries.

`google-cloud-cpp` depends on the proto files in the
[googleapis][googleapis-repo]. The build scripts in `google-cloud-cpp` are
pinned to a specific commit SHA of this repository. That avoids unexpected
breakage for us and our customers as `googleapis` makes changes. From time to
time we need to manually update this commit SHA. This document describes these
steps.

## Set your working directory

Go to whatever directory holds your clone of the project, for example:

```shell
cd $HOME/google-cloud-cpp
```

## Create a branch to make your changes

```shell
git checkout main
git checkout -b chore-update-googleapis-sha-circa-$(date +%Y-%m-%d)
```

## Run the "renovate.sh" script

```shell
external/googleapis/renovate.sh
```

## Verify everything compiles

```shell
bazel build //google/cloud/...
ci/cloudbuild/build.sh -t cmake-install-pr
```

## Push the branch and create a pull request

```shell
git push --set-upstream origin "$(git branch --show-current)"
```

Then use your favorite workflow to create the PR.

[googleapis-repo]: https://github.com/googleapis/googleapis.git
