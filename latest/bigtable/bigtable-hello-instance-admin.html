<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Bigtable C++ Client: Example: C++ Hello World for Instance Admin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Bigtable C++ Client
   &#160;<span id="projectnumber">1.27.0</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Bigtable</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example: C++ Hello World for Instance Admin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example is a very simple "Instance Admin" application, which illustrates how to:</p>
<ul>
<li>Create a production instance.</li>
<li>List the existing instances.</li>
<li>Get the metadata for an instance.</li>
<li>List all the clusters in an instance.</li>
<li>Delete an instance.</li>
</ul>
<h2><a class="anchor" id="autotoc_md0"></a>
Run the example</h2>
<p>This example uses the <a href="https://googleapis.github.io/google-cloud-cpp">Cloud Bigtable C++ Client Library</a> to communicate with Cloud Bigtable.</p>
<p>To run the example program, follow the <a href="https://github.com/googleapis/google-cloud-cpp/tree/master/google/cloud/bigtable/examples/">instructions</a> for the example on GitHub.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Include the Necessary Headers</h2>
<p>The example uses the following headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin_8h.html">google/cloud/bigtable/instance_admin.h</a>&quot;</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md2"></a>
Define aliases</h2>
<p>To make the example less verbose we define some aliases:</p>
<div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">cbt</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md3"></a>
Connect to the Cloud Bigtable instance admin endpoint.</h2>
<p>Create an object of type <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">bigtable::InstanceAdmin</a> to obtain information about <em>Instances</em>, <em>Clusters</em>, <em>Application Profiles</em>, and to change the <em>IAM permissions</em> in a Cloud Bigtable instance:</p>
<div class="fragment"><div class="line">  <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">cbt::InstanceAdmin</a> instance_admin(</div>
<div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a065da25598f925993d74b7e42bbbb5ef">cbt::CreateDefaultInstanceAdminClient</a>(project_id, <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClientOptions.html">cbt::ClientOptions</a>()));</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a href="https://cloud.google.com/bigtable/docs/instances-clusters-nodes">https://cloud.google.com/bigtable/docs/instances-clusters-nodes</a> for more information about Cloud Bigtable instances, clusters, and nodes. </dd>
<dd>
<a href="https://cloud.google.com/bigtable/docs/app-profiles">https://cloud.google.com/bigtable/docs/app-profiles</a> for more information about Cloud Bigtable application profiles. </dd>
<dd>
<a href="https://cloud.google.com/bigtable/docs/access-control">https://cloud.google.com/bigtable/docs/access-control</a> for more information access controls via IAM permissions on Cloud Bigtable.</dd></dl>
<h2><a class="anchor" id="autotoc_md4"></a>
Check if an Instance already exists</h2>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nCheck Instance exists:\n&quot;</span>;</div>
<div class="line">  StatusOr&lt;cbt::InstanceList&gt; instances = instance_admin.ListInstances();</div>
<div class="line">  <span class="keywordflow">if</span> (!instances) <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cerr</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div>
<div class="line">    }</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">auto</span> instance_name =</div>
<div class="line">      instance_admin.project_name() + <span class="stringliteral">&quot;/instances/&quot;</span> + instance_id;</div>
<div class="line">  <span class="keywordtype">bool</span> instance_exists = google::cloud::internal::ContainsIf(</div>
<div class="line">      instances-&gt;instances,</div>
<div class="line">      [&amp;instance_name](<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a098b52714cb305f401b93f3c0d6c8449">google::bigtable::admin::v2::Instance</a> <span class="keyword">const</span>&amp; i) {</div>
<div class="line">        return i.name() == instance_name;</div>
<div class="line">      });</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The instance &quot;</span> &lt;&lt; instance_id</div>
<div class="line">            &lt;&lt; (instance_exists ? <span class="stringliteral">&quot; already exists&quot;</span> : <span class="stringliteral">&quot; does not exist&quot;</span>)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#a60844ae9110014889b77ee24129de5d5">InstanceAdmin::GetInstance()</a> for another operation to query if an instance exists.</dd></dl>
<h2><a class="anchor" id="autotoc_md5"></a>
Create a Production Instance</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#ac50920c09a6f964085bb86b14f53d75b">InstanceAdmin::CreateInstance()</a> to create a new instance:</p>
<div class="fragment"><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\nCreating a PRODUCTION Instance: &quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// production instance needs at least 3 nodes</span></div>
<div class="line">    <span class="keyword">auto</span> cluster_config = <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClusterConfig.html">cbt::ClusterConfig</a>(zone, 3, cbt::ClusterConfig::HDD);</div>
<div class="line">    <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html">cbt::InstanceConfig</a> config(instance_id, <span class="stringliteral">&quot;Sample Instance&quot;</span>,</div>
<div class="line">                               {{cluster_id, cluster_config}});</div>
<div class="line">    config.<a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html#a4c3516d4f77c558a22ccf5d1bb34c7a9">set_type</a>(cbt::InstanceConfig::PRODUCTION);</div>
<div class="line"> </div>
<div class="line">    google::cloud::future&lt;void&gt; creation_done =</div>
<div class="line">        instance_admin.CreateInstance(config).then(</div>
<div class="line">            [instance_id](</div>
<div class="line">                future&lt;StatusOr&lt;google::bigtable::admin::v2::Instance&gt;&gt; f) {</div>
<div class="line">              <span class="keyword">auto</span> instance = f.get();</div>
<div class="line">              <span class="keywordflow">if</span> (!instance) {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Could not create instance &quot;</span> &lt;&lt; instance_id</div>
<div class="line">                          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div>
<div class="line">              }</div>
<div class="line">              std::cout &lt;&lt; <span class="stringliteral">&quot;Successfully created instance: &quot;</span></div>
<div class="line">                        &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            });</div>
<div class="line">    <span class="comment">// Note how this blocks until the instance is created, in production code</span></div>
<div class="line">    <span class="comment">// you may want to perform this task asynchronously.</span></div>
<div class="line">    creation_done.get();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html">bigtable::InstanceConfig</a> to define the initial attributes of a new instance.</dd></dl>
<h2><a class="anchor" id="autotoc_md6"></a>
List Instances in a Project</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#a73a4b95b901129d28e74c17b4e293411">InstanceAdmin::ListInstances()</a> to list all the instances in the project:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Instances:\n&quot;</span>;</div>
<div class="line">  instances = instance_admin.ListInstances();</div>
<div class="line">  <span class="keywordflow">if</span> (!instances) <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cerr</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div>
<div class="line">    }</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; instance : instances-&gt;instances) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; instance.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd>The gRPC API documentation for <a href="https://cloud.google.com/bigtable/docs/reference/admin/rpc/google.bigtable.admin.v2#google.bigtable.admin.v2.ListInstancesResponse">ListInstances</a> has more details on when <code>failed_locations</code> might be populated.</dd></dl>
<h2><a class="anchor" id="autotoc_md7"></a>
Get an Instance Metadata</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#a60844ae9110014889b77ee24129de5d5">InstanceAdmin::GetInstance()</a> to retrieve the metadata of an instance:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nGet Instance:\n&quot;</span>;</div>
<div class="line">  <span class="keyword">auto</span> instance = instance_admin.GetInstance(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!instance) <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Instance details :\n&quot;</span> &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md8"></a>
List clusters in an Instance</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#aff94dfb0492c9c6c73e9b29857549020">InstanceAdmin::ListClusters()</a> to list all the clusters in an instance (or all the clusters in a project):</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Clusters:\n&quot;</span>;</div>
<div class="line">  StatusOr&lt;cbt::ClusterList&gt; cluster_list =</div>
<div class="line">      instance_admin.ListClusters(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!cluster_list) <span class="keywordflow">throw</span> std::runtime_error(cluster_list.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!cluster_list-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The Cloud Bigtable service reports that the following &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;locations are temporarily unavailable and no information &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;about clusters in these locations can be obtained:\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : cluster_list-&gt;failed_locations) {</div>
<div class="line">      std::cout &lt;&lt; failed_location &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name List:\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; cluster : cluster_list-&gt;clusters) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name: &quot;</span> &lt;&lt; cluster.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd>The <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">bigtable::InstanceAdmin</a> class also has functions to <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#a213dd25989a612adf21074ecb8a05d24">create</a>, <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#afe746ee1bcfd82bcbcf9e96d987e1597">update</a>, <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#ab1b639029d0568c3cb7b4efc62bceb3c">delete</a>, and <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#afe746ee1bcfd82bcbcf9e96d987e1597">retrieve the metadata</a> of a Cluster. </dd>
<dd>
The gRPC API documentation for <a href="https://cloud.google.com/bigtable/docs/reference/admin/rpc/google.bigtable.admin.v2#google.bigtable.admin.v2.ListClustersResponse">ListClusters</a> has more details on when <code>failed_locations</code> might be populated.</dd></dl>
<h2><a class="anchor" id="autotoc_md9"></a>
Delete an instance</h2>
<p>Finally, use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html#a486006fc1866998ac8c9ae4d808572b1">InstanceAdmin::DeleteInstance()</a> to delete an instance:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Deleting instance &quot;</span> &lt;&lt; instance_id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  google::cloud::Status delete_status =</div>
<div class="line">      instance_admin.DeleteInstance(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!delete_status.ok()) <span class="keywordflow">throw</span> std::runtime_error(delete_status.message());</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
</div><!-- fragment --> <dl class="section warning"><dt>Warning</dt><dd>Note that this function will delete the instance even if it contains tables with data in them. For mission critical data you must ensure that the data is backed up before calling this function.</dd></dl>
<h2><a class="anchor" id="autotoc_md10"></a>
Put it all together</h2>
<p>Here is the full example</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin_8h.html">google/cloud/bigtable/instance_admin.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bigtable__examples__common_8h.html">google/cloud/bigtable/examples/bigtable_examples_common.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/bigtable/testing/cleanup_stale_resources.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/bigtable/testing/random_names.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/internal/algorithm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/internal/getenv.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/internal/random.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;google/cloud/testing_util/crash_handler.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> google::cloud::bigtable::examples::Usage;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> BigtableHelloInstance(std::vector&lt;std::string&gt; <span class="keyword">const</span>&amp; argv) {</div>
<div class="line">  <span class="keywordflow">if</span> (argv.size() != 4) {</div>
<div class="line">    <span class="keywordflow">throw</span> Usage{</div>
<div class="line">        <span class="stringliteral">&quot;bigtable-hello-instance &lt;project-id&gt; &lt;instance-id&gt; &lt;cluster-id&gt; &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;zone&gt;&quot;</span>};</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  std::string <span class="keyword">const</span> project_id = argv[0];</div>
<div class="line">  std::string <span class="keyword">const</span> instance_id = argv[1];</div>
<div class="line">  std::string <span class="keyword">const</span> cluster_id = argv[2];</div>
<div class="line">  std::string <span class="keyword">const</span> zone = argv[3];</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">cbt</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Connect to the Cloud Bigtable admin endpoint.</span></div>
<div class="line"><span class="comment"></span>  <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">cbt::InstanceAdmin</a> instance_admin(</div>
<div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a065da25598f925993d74b7e42bbbb5ef">cbt::CreateDefaultInstanceAdminClient</a>(project_id, <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClientOptions.html">cbt::ClientOptions</a>()));</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nCheck Instance exists:\n&quot;</span>;</div>
<div class="line">  StatusOr&lt;cbt::InstanceList&gt; instances = instance_admin.ListInstances();</div>
<div class="line">  <span class="keywordflow">if</span> (!instances) <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cerr</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div>
<div class="line">    }</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">auto</span> instance_name =</div>
<div class="line">      instance_admin.project_name() + <span class="stringliteral">&quot;/instances/&quot;</span> + instance_id;</div>
<div class="line">  <span class="keywordtype">bool</span> instance_exists = google::cloud::internal::ContainsIf(</div>
<div class="line">      instances-&gt;instances,</div>
<div class="line">      [&amp;instance_name](<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a098b52714cb305f401b93f3c0d6c8449">google::bigtable::admin::v2::Instance</a> <span class="keyword">const</span>&amp; i) {</div>
<div class="line">        return i.name() == instance_name;</div>
<div class="line">      });</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The instance &quot;</span> &lt;&lt; instance_id</div>
<div class="line">            &lt;&lt; (instance_exists ? <span class="stringliteral">&quot; already exists&quot;</span> : <span class="stringliteral">&quot; does not exist&quot;</span>)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create instance if does not exists</span></div>
<div class="line">  <span class="keywordflow">if</span> (!instance_exists) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\nCreating a PRODUCTION Instance: &quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// production instance needs at least 3 nodes</span></div>
<div class="line">    <span class="keyword">auto</span> cluster_config = <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClusterConfig.html">cbt::ClusterConfig</a>(zone, 3, cbt::ClusterConfig::HDD);</div>
<div class="line">    <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html">cbt::InstanceConfig</a> config(instance_id, <span class="stringliteral">&quot;Sample Instance&quot;</span>,</div>
<div class="line">                               {{cluster_id, cluster_config}});</div>
<div class="line">    config.<a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html#a4c3516d4f77c558a22ccf5d1bb34c7a9">set_type</a>(cbt::InstanceConfig::PRODUCTION);</div>
<div class="line"> </div>
<div class="line">    google::cloud::future&lt;void&gt; creation_done =</div>
<div class="line">        instance_admin.CreateInstance(config).then(</div>
<div class="line">            [instance_id](</div>
<div class="line">                future&lt;StatusOr&lt;google::bigtable::admin::v2::Instance&gt;&gt; f) {</div>
<div class="line">              <span class="keyword">auto</span> instance = f.get();</div>
<div class="line">              <span class="keywordflow">if</span> (!instance) {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Could not create instance &quot;</span> &lt;&lt; instance_id</div>
<div class="line">                          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div>
<div class="line">              }</div>
<div class="line">              std::cout &lt;&lt; <span class="stringliteral">&quot;Successfully created instance: &quot;</span></div>
<div class="line">                        &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            });</div>
<div class="line">    <span class="comment">// Note how this blocks until the instance is created, in production code</span></div>
<div class="line">    <span class="comment">// you may want to perform this task asynchronously.</span></div>
<div class="line">    creation_done.get();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Instances:\n&quot;</span>;</div>
<div class="line">  instances = instance_admin.ListInstances();</div>
<div class="line">  <span class="keywordflow">if</span> (!instances) <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cerr</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div>
<div class="line">    }</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; instance : instances-&gt;instances) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; instance.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nGet Instance:\n&quot;</span>;</div>
<div class="line">  <span class="keyword">auto</span> instance = instance_admin.GetInstance(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!instance) <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Instance details :\n&quot;</span> &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Clusters:\n&quot;</span>;</div>
<div class="line">  StatusOr&lt;cbt::ClusterList&gt; cluster_list =</div>
<div class="line">      instance_admin.ListClusters(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!cluster_list) <span class="keywordflow">throw</span> std::runtime_error(cluster_list.status().message());</div>
<div class="line">  <span class="keywordflow">if</span> (!cluster_list-&gt;failed_locations.empty()) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The Cloud Bigtable service reports that the following &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;locations are temporarily unavailable and no information &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;about clusters in these locations can be obtained:\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : cluster_list-&gt;failed_locations) {</div>
<div class="line">      std::cout &lt;&lt; failed_location &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name List:\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; cluster : cluster_list-&gt;clusters) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name: &quot;</span> &lt;&lt; cluster.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Deleting instance &quot;</span> &lt;&lt; instance_id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  google::cloud::Status delete_status =</div>
<div class="line">      instance_admin.DeleteInstance(instance_id);</div>
<div class="line">  <span class="keywordflow">if</span> (!delete_status.ok()) <span class="keywordflow">throw</span> std::runtime_error(delete_status.message());</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> RunAll(std::vector&lt;std::string&gt; <span class="keyword">const</span>&amp; argv) {</div>
<div class="line">  <span class="keyword">namespace </span>examples = ::google::cloud::bigtable::examples;</div>
<div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">cbt</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!argv.empty()) <span class="keywordflow">throw</span> Usage{<span class="stringliteral">&quot;auto&quot;</span>};</div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1examples.html#a9b4958db722b1497b5b95e7d3b28ff0b">examples::RunAdminIntegrationTests</a>()) <span class="keywordflow">return</span>;</div>
<div class="line">  examples::CheckEnvironmentVariablesAreSet({</div>
<div class="line">      <span class="stringliteral">&quot;GOOGLE_CLOUD_PROJECT&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;GOOGLE_CLOUD_CPP_BIGTABLE_TEST_ZONE_A&quot;</span>,</div>
<div class="line">  });</div>
<div class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> project_id =</div>
<div class="line">      google::cloud::internal::GetEnv(<span class="stringliteral">&quot;GOOGLE_CLOUD_PROJECT&quot;</span>).value();</div>
<div class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> zone_a =</div>
<div class="line">      google::cloud::internal::GetEnv(<span class="stringliteral">&quot;GOOGLE_CLOUD_CPP_BIGTABLE_TEST_ZONE_A&quot;</span>)</div>
<div class="line">          .value();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">cbt::InstanceAdmin</a> admin(</div>
<div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a065da25598f925993d74b7e42bbbb5ef">cbt::CreateDefaultInstanceAdminClient</a>(project_id, <a class="code" href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClientOptions.html">cbt::ClientOptions</a>{}));</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> generator = google::cloud::internal::DefaultPRNG(std::random_device{}());</div>
<div class="line">  google::cloud::bigtable::testing::CleanupStaleInstances(admin);</div>
<div class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> instance_id =</div>
<div class="line">      google::cloud::bigtable::testing::RandomInstanceId(generator);</div>
<div class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> cluster_id = instance_id + <span class="stringliteral">&quot;-c1&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nRunning the BigtableHelloInstance() example&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  BigtableHelloInstance({project_id, instance_id, cluster_id, zone_a});</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="bigtable__grpc__credentials_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  google::cloud::testing_util::InstallCrashHandler(argv[0]);</div>
<div class="line"> </div>
<div class="line">  google::cloud::bigtable::examples::Example example({</div>
<div class="line">      {<span class="stringliteral">&quot;auto&quot;</span>, RunAll},</div>
<div class="line">      {<span class="stringliteral">&quot;hello-instance&quot;</span>, BigtableHelloInstance},</div>
<div class="line">  });</div>
<div class="line">  <span class="keywordflow">return</span> example.Run(argc, argv);</div>
<div class="line">}</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceAdmin.html">google::cloud::bigtable::v1::InstanceAdmin</a></div><div class="ttdoc">Implements the APIs to administer Cloud Bigtable instances.</div><div class="ttdef"><b>Definition:</b> <a href="instance__admin_8h_source.html#l00124">instance_admin.h:124</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1bigtable_1_1examples_html_a9b4958db722b1497b5b95e7d3b28ff0b"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1bigtable_1_1examples.html#a9b4958db722b1497b5b95e7d3b28ff0b">google::cloud::bigtable::examples::RunAdminIntegrationTests</a></div><div class="ttdeci">bool RunAdminIntegrationTests()</div><div class="ttdef"><b>Definition:</b> <a href="bigtable__examples__common_8cc_source.html#l00033">bigtable_examples_common.cc:33</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig_html_a4c3516d4f77c558a22ccf5d1bb34c7a9"><div class="ttname"><a href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html#a4c3516d4f77c558a22ccf5d1bb34c7a9">google::cloud::bigtable::v1::InstanceConfig::set_type</a></div><div class="ttdeci">InstanceConfig &amp; set_type(InstanceType type)</div><div class="ttdef"><b>Definition:</b> <a href="instance__config_8h_source.html#l00054">instance_config.h:54</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1bigtable_1_1v1_html_a098b52714cb305f401b93f3c0d6c8449"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a098b52714cb305f401b93f3c0d6c8449">google::cloud::bigtable::v1::Instance</a></div><div class="ttdeci">::google::bigtable::admin::v2::Instance Instance</div><div class="ttdef"><b>Definition:</b> <a href="instance__update__config_8h_source.html#l00030">instance_update_config.h:30</a></div></div>
<div class="ttc" id="ainstance__admin_8h_html"><div class="ttname"><a href="instance__admin_8h.html">instance_admin.h</a></div></div>
<div class="ttc" id="abigtable__grpc__credentials_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="bigtable__grpc__credentials_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="bigtable__grpc__credentials_8cc_source.html#l00148">bigtable_grpc_credentials.cc:148</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClientOptions_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClientOptions.html">google::cloud::bigtable::v1::ClientOptions</a></div><div class="ttdoc">Configuration options for the Bigtable Client.</div><div class="ttdef"><b>Definition:</b> <a href="client__options_8h_source.html#l00050">client_options.h:50</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClusterConfig_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1ClusterConfig.html">google::cloud::bigtable::v1::ClusterConfig</a></div><div class="ttdoc">Specify the initial configuration for a new cluster.</div><div class="ttdef"><b>Definition:</b> <a href="cluster__config_8h_source.html#l00028">cluster_config.h:28</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1bigtable_1_1v1_1_1InstanceConfig.html">google::cloud::bigtable::v1::InstanceConfig</a></div><div class="ttdoc">Specify the initial configuration for a new instance.</div><div class="ttdef"><b>Definition:</b> <a href="instance__config_8h_source.html#l00030">instance_config.h:30</a></div></div>
<div class="ttc" id="abigtable__examples__common_8h_html"><div class="ttname"><a href="bigtable__examples__common_8h.html">bigtable_examples_common.h</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1bigtable_html"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a></div><div class="ttdoc">Contains all the Cloud Bigtable C++ client APIs.</div><div class="ttdef"><b>Definition:</b> <a href="admin__client_8cc_source.html#l00023">admin_client.cc:23</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1bigtable_1_1v1_html_a065da25598f925993d74b7e42bbbb5ef"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a065da25598f925993d74b7e42bbbb5ef">google::cloud::bigtable::v1::CreateDefaultInstanceAdminClient</a></div><div class="ttdeci">std::shared_ptr&lt; InstanceAdminClient &gt; CreateDefaultInstanceAdminClient(std::string project, ClientOptions options)</div><div class="ttdoc">Create a new admin client configured via options.</div><div class="ttdef"><b>Definition:</b> <a href="instance__admin__client_8cc_source.html#l00380">instance_admin_client.cc:380</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
